

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IV. Basics of Network Analysis &#8212; Urban Cartography</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'modules/module_4/module_4';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Spatial Data Analysis and Visualisation in Urban Cartography
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../module_0/module_01.html">Environment setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module_0/module_02.html">Python in GIS</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../module_1/module_10.html">I. Geospatial Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module_1/module_11.html">I.1 Spatial Data Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module_1/module_12.html">I.2 Reading and Exploring Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module_1/module_13.html">I.3 Exporting data from OSM</a></li>

</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fmodules/module_4/module_4.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/modules/module_4/module_4.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>IV. Basics of Network Analysis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">IV. Basics of Network Analysis</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#iv">IV. Введение в сетевой анализ</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#osmnx">1.Графы улично-дорожной сети из osmnx</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">1.1 Получение графа уличной сети</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#geodataframe">1.2 Преобразование графа в GeoDataFrame</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#networkx">2. Пространственный сетевой анализ и networkx</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">2.1 Поиск кратчайшего пути между двумя точками</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">2.2 Вычисление центральности в узле графов</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">2.3 Нахождение компонент связности в графе</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">2.4 Вычисление матрицы расстояний между узлами</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">2.5 Изохроны (пешеходная доступность)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#api">3. Пространственный сетевой анализ с использованием внешних API</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#osrm">3.1. OSRM</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">3.1.1 Кратчайшее расстояние</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#open-route-service">3.2. Open Route Service</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">3.2.1. Изохроны</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">3.2.2. Кратчайшее расстояние</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">3.2.3 Матрица расстояний</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#graphopper">3.3 Graphopper</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">3.3.1. Кратчайшее расстояние</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">3.3.2 Матрица расстояний</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="tex2jax_ignore mathjax_ignore section" id="iv-basics-of-network-analysis">
<h1>IV. Basics of Network Analysis<a class="headerlink" href="#iv-basics-of-network-analysis" title="Permalink to this heading">#</a></h1>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="iv">
<h1>IV. Введение в сетевой анализ<a class="headerlink" href="#iv" title="Permalink to this heading">#</a></h1>
<div class="section" id="osmnx">
<h2>1.Графы улично-дорожной сети из osmnx<a class="headerlink" href="#osmnx" title="Permalink to this heading">#</a></h2>
<p>Библиотека osmnx предоставляет удобные инструменты для работы с улично-дорожной сетью как с графом.</p>
<p>Графы в osmnx представляют собой математические структуры, где:</p>
<ul class="simple">
<li><p>Узлы (nodes) — это объекты на уличной сети, например, перекрестки или конечные точки дорог.</p></li>
<li><p>Ребра (edges) — это соединения между узлами, то есть сегменты дорог, улиц или других типов инфраструктуры.</p></li>
</ul>
<p>В osmnx используется структура графа, где ребра могут содержать информацию о расстояниях, времени в пути, типах дорог и других характеристиках транспортной сети. С помощью этого подхода можно анализировать доступность, проводить сетевой анализ, искать кратчайшие пути, строить зоны доступности и многое другое.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">osmnx</span> <span class="k">as</span> <span class="nn">ox</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h3>1.1 Получение графа уличной сети<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<p>Сначала создадим граф для района с использованием данных OpenStreetMap (OSM).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Указываем район (например, Ленинский район Екатеринбурга)</span>
<span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;Ленинский район, Екатеринбург&quot;</span>

<span class="c1"># Получаем граф уличной сети для района с типом &quot;drive&quot; (автомобильный)</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">graph_from_place</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">network_type</span><span class="o">=</span><span class="s1">&#39;drive&#39;</span><span class="p">)</span>

<span class="c1"># Строим граф</span>
<span class="n">ox</span><span class="o">.</span><span class="n">plot_graph</span><span class="p">(</span><span class="n">ox</span><span class="o">.</span><span class="n">project_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/218195adaa104bdd5a83d58269d19ae5d3919665e890330006bf691a982ace8a.png" src="../../_images/218195adaa104bdd5a83d58269d19ae5d3919665e890330006bf691a982ace8a.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 800x800 with 1 Axes&gt;, &lt;Axes: &gt;)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="geodataframe">
<h3>1.2 Преобразование графа в GeoDataFrame<a class="headerlink" href="#geodataframe" title="Permalink to this heading">#</a></h3>
<p>Для анализа и визуализации данных можно преобразовать граф в геометрический формат, например, в GeoDataFrame, чтобы работать с линиями и узлами как с геометриями</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Получаем узлы и ребра в формате GeoDataFrame</span>
<span class="n">nodes</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">graph_to_gdfs</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>

<span class="c1"># Визуализируем ребра</span>
<span class="n">edges</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../../_images/db200da19b7526067b65c0d4595e8e4ef7f470342f4702d1e25c8819f2230a0e.png" src="../../_images/db200da19b7526067b65c0d4595e8e4ef7f470342f4702d1e25c8819f2230a0e.png" />
</div>
</div>
</div>
</div>
<div class="section" id="networkx">
<h2>2. Пространственный сетевой анализ и networkx<a class="headerlink" href="#networkx" title="Permalink to this heading">#</a></h2>
<div class="section" id="id2">
<h3>2.1 Поиск кратчайшего пути между двумя точками<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<p>Одним из наиболее распространенных применений сетевого анализа является нахождение кратчайшего пути между двумя точками</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Указываем стартовую и конечную точки </span>
<span class="n">start_coords</span> <span class="o">=</span> <span class="p">(</span><span class="mf">60.6572</span><span class="p">,</span> <span class="mf">56.8385</span><span class="p">)</span> 
<span class="n">end_coords</span> <span class="o">=</span> <span class="p">(</span><span class="mf">60.6570</span><span class="p">,</span> <span class="mf">56.8100</span><span class="p">)</span>    

<span class="c1"># Преобразуем координаты в узлы графа</span>
<span class="n">start_node</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">nearest_nodes</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">start_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y</span><span class="o">=</span><span class="n">start_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">end_node</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">nearest_nodes</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">end_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y</span><span class="o">=</span><span class="n">end_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Находим кратчайший путь между двумя узлами</span>
<span class="n">route</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">start_node</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">end_node</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;length&#39;</span><span class="p">)</span>

<span class="c1"># Визуализируем маршрут</span>
<span class="n">ox</span><span class="o">.</span><span class="n">plot_graph_route</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">route_linewidth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/bf4f1798c6d42cd2672c7f906efba7d2b0e6e9e1597e311a01651041b68018b7.png" src="../../_images/bf4f1798c6d42cd2672c7f906efba7d2b0e6e9e1597e311a01651041b68018b7.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 800x800 with 1 Axes&gt;, &lt;Axes: &gt;)
</pre></div>
</div>
</div>
</div>
<p>Кратчайший путь между POI</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Загружаем POI (например, рестораны)</span>
<span class="n">pois</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">geometries_from_place</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;amenity&quot;</span><span class="p">:</span> <span class="s2">&quot;restaurant&quot;</span><span class="p">})</span>

<span class="c1"># Конвертация POI в ту же систему координат, что и граф</span>
<span class="n">pois</span> <span class="o">=</span> <span class="n">pois</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">graph</span><span class="p">[</span><span class="s2">&quot;crs&quot;</span><span class="p">])</span>

<span class="c1"># Выбираем две случайные точки из pois</span>
<span class="n">random_points</span> <span class="o">=</span> <span class="n">pois</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span> 
<span class="n">poi_1</span> <span class="o">=</span> <span class="n">random_points</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">geometry</span>
<span class="n">poi_2</span> <span class="o">=</span> <span class="n">random_points</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">geometry</span>

<span class="c1"># Шаг 2: Поиск ближайших узлов графа к POI</span>
<span class="n">orig_node</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">nearest_nodes</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">poi_1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">poi_1</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
<span class="n">dest_node</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">nearest_nodes</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">poi_2</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">poi_2</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># Шаг 3: Кратчайший путь</span>
<span class="n">shortest_path</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">orig_node</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">dest_node</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;length&quot;</span><span class="p">)</span>
<span class="n">shortest_distance</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path_length</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">orig_node</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">dest_node</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;length&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shortest path:&quot;</span><span class="p">,</span> <span class="n">shortest_path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shortest distance (meters):&quot;</span><span class="p">,</span> <span class="n">shortest_distance</span><span class="p">)</span>

<span class="c1"># Визуализация</span>
<span class="n">ox</span><span class="o">.</span><span class="n">plot_graph_route</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">shortest_path</span><span class="p">,</span> <span class="n">route_linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/ry/9bb7wrz54vq_kn2ytlj6ynzm0000gn/T/ipykernel_38472/281450167.py:2: FutureWarning: The `geometries` module and `geometries_from_X` functions have been renamed the `features` module and `features_from_X` functions. Use these instead. The `geometries` module and function names are deprecated and will be removed in the v2.0.0 release. See the OSMnx v2 migration guide: https://github.com/gboeing/osmnx/issues/1123
  pois = ox.geometries_from_place(location, tags={&quot;amenity&quot;: &quot;restaurant&quot;})
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Shortest path: [223291355, 175048165, 1387234850, 2908690121, 1387234852, 10581827806, 806275555, 176144584, 10798749441, 10798749439]
Shortest distance (meters): 1170.84
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/frame.py:717: DeprecationWarning: Passing a BlockManager to GeoDataFrame is deprecated and will raise in a future version. Use public APIs instead.
  warnings.warn(
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/frame.py:717: DeprecationWarning: Passing a BlockManager to GeoDataFrame is deprecated and will raise in a future version. Use public APIs instead.
  warnings.warn(
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/frame.py:717: DeprecationWarning: Passing a BlockManager to GeoDataFrame is deprecated and will raise in a future version. Use public APIs instead.
  warnings.warn(
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/algorithms.py:1743: DeprecationWarning: is_sparse is deprecated and will be removed in a future version. Check `isinstance(dtype, pd.SparseDtype)` instead.
  return lib.map_infer(values, mapper, convert=convert)
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/sklearn/utils/validation.py:605: DeprecationWarning: is_sparse is deprecated and will be removed in a future version. Check `isinstance(dtype, pd.SparseDtype)` instead.
  if is_sparse(pd_dtype):
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/sklearn/utils/validation.py:614: DeprecationWarning: is_sparse is deprecated and will be removed in a future version. Check `isinstance(dtype, pd.SparseDtype)` instead.
  if is_sparse(pd_dtype) or not is_extension_array_dtype(pd_dtype):
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/frame.py:717: DeprecationWarning: Passing a BlockManager to GeoDataFrame is deprecated and will raise in a future version. Use public APIs instead.
  warnings.warn(
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/algorithms.py:1743: DeprecationWarning: is_sparse is deprecated and will be removed in a future version. Check `isinstance(dtype, pd.SparseDtype)` instead.
  return lib.map_infer(values, mapper, convert=convert)
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/sklearn/utils/validation.py:605: DeprecationWarning: is_sparse is deprecated and will be removed in a future version. Check `isinstance(dtype, pd.SparseDtype)` instead.
  if is_sparse(pd_dtype):
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/sklearn/utils/validation.py:614: DeprecationWarning: is_sparse is deprecated and will be removed in a future version. Check `isinstance(dtype, pd.SparseDtype)` instead.
  if is_sparse(pd_dtype) or not is_extension_array_dtype(pd_dtype):
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/frame.py:717: DeprecationWarning: Passing a BlockManager to GeoDataFrame is deprecated and will raise in a future version. Use public APIs instead.
  warnings.warn(
</pre></div>
</div>
<img alt="../../_images/e0a0120f8001ef6a2732d613e895f7a0f63461fa704f95e664faf842c7ca90e3.png" src="../../_images/e0a0120f8001ef6a2732d613e895f7a0f63461fa704f95e664faf842c7ca90e3.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 800x800 with 1 Axes&gt;, &lt;Axes: &gt;)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id3">
<h3>2.2 Вычисление центральности в узле графов<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h3>
<p>Центральность узлов в графе помогает определить важность каждого узла в сети.</p>
<p>Существует несколько типов центральности, которые могут быть использованы в зависимости от задачи:</p>
<ol class="arabic simple">
<li><p>Центральность по степени (Degree Centrality) — измеряет количество связей (ребер), которые имеет узел. Узлы с высокой степенью центральности считаются важными, потому что они подключены к большому числу других узлов.</p></li>
<li><p>Центральность по посредничеству (Betweenness Centrality) — измеряет, насколько часто узел находится на кратчайших путях между другими узлами. Узлы с высокой центральностью между отношениями являются “мостами”, которые связывают различные части сети.</p></li>
<li><p>Центральность по близости (Closeness Centrality) — измеряет, насколько близко узел расположен к остальным узлам в сети. Узлы с высокой центральностью по близости быстро достигают других узлов, что делает их важными для распространения информации.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Преобразуем в проекцию UTM для удобства расчетов</span>
<span class="n">graph_projected</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">project_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>

<span class="c1"># Центральность по степени</span>
<span class="n">degree_centrality</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">degree_centrality</span><span class="p">(</span><span class="n">graph_projected</span><span class="p">)</span>

<span class="c1"># Центральность по посредничеству  (betweenness centrality)</span>
<span class="n">betweenness_centrality</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">betweenness_centrality</span><span class="p">(</span><span class="n">graph_projected</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;length&#39;</span><span class="p">)</span>

<span class="c1"># Центральность по близости</span>
<span class="n">closeness_centrality</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">closeness_centrality</span><span class="p">(</span><span class="n">graph_projected</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/frame.py:717: DeprecationWarning: Passing a BlockManager to GeoDataFrame is deprecated and will raise in a future version. Use public APIs instead.
  warnings.warn(
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/frame.py:717: DeprecationWarning: Passing a BlockManager to GeoDataFrame is deprecated and will raise in a future version. Use public APIs instead.
  warnings.warn(
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/frame.py:717: DeprecationWarning: Passing a BlockManager to GeoDataFrame is deprecated and will raise in a future version. Use public APIs instead.
  warnings.warn(
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/frame.py:717: DeprecationWarning: Passing a BlockManager to GeoDataFrame is deprecated and will raise in a future version. Use public APIs instead.
  warnings.warn(
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/frame.py:717: DeprecationWarning: Passing a BlockManager to GeoDataFrame is deprecated and will raise in a future version. Use public APIs instead.
  warnings.warn(
</pre></div>
</div>
</div>
</div>
<p>Центральность по степени: На карте уличной сети выделяются наиболее “связанные” узлы.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Визуализация центральности по степени</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">node_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="o">*</span> <span class="mi">1000</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">degree_centrality</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span> 

<span class="n">ox</span><span class="o">.</span><span class="n">plot_graph</span><span class="p">(</span><span class="n">graph_projected</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="n">node_sizes</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Центральность по степени&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/frame.py:717: DeprecationWarning: Passing a BlockManager to GeoDataFrame is deprecated and will raise in a future version. Use public APIs instead.
  warnings.warn(
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/frame.py:717: DeprecationWarning: Passing a BlockManager to GeoDataFrame is deprecated and will raise in a future version. Use public APIs instead.
  warnings.warn(
</pre></div>
</div>
<img alt="../../_images/a3d07c6ee6c5b9ab274d95351450015f5e1732c356581e16d60cc1671cb05c92.png" src="../../_images/a3d07c6ee6c5b9ab274d95351450015f5e1732c356581e16d60cc1671cb05c92.png" />
</div>
</div>
<p>Центральность по посредничеству : Отображение узлов, которые служат “мостами” между различными частями сети.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Визуализация центральности по посредничеству </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">node_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="o">*</span> <span class="mi">1000</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">betweenness_centrality</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>

<span class="n">ox</span><span class="o">.</span><span class="n">plot_graph</span><span class="p">(</span><span class="n">graph_projected</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="n">node_sizes</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Центральность по посредничеству &quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/frame.py:717: DeprecationWarning: Passing a BlockManager to GeoDataFrame is deprecated and will raise in a future version. Use public APIs instead.
  warnings.warn(
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/frame.py:717: DeprecationWarning: Passing a BlockManager to GeoDataFrame is deprecated and will raise in a future version. Use public APIs instead.
  warnings.warn(
</pre></div>
</div>
<img alt="../../_images/19618108d83df58fe725774b21b0c8335ba7ff0401c08562bbfed9e9c781568b.png" src="../../_images/19618108d83df58fe725774b21b0c8335ba7ff0401c08562bbfed9e9c781568b.png" />
</div>
</div>
<p>Центральность по близости: Выделение узлов, которые могут быстро достигать других узлов в сети.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Визуализация центральности по близости</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">node_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="o">*</span> <span class="mi">1000</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">closeness_centrality</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>

<span class="n">ox</span><span class="o">.</span><span class="n">plot_graph</span><span class="p">(</span><span class="n">graph_projected</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="n">node_sizes</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Центральность по близости&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/frame.py:717: DeprecationWarning: Passing a BlockManager to GeoDataFrame is deprecated and will raise in a future version. Use public APIs instead.
  warnings.warn(
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/frame.py:717: DeprecationWarning: Passing a BlockManager to GeoDataFrame is deprecated and will raise in a future version. Use public APIs instead.
  warnings.warn(
</pre></div>
</div>
<img alt="../../_images/62524420f83fa4d0b36978e3dc0d18218cbcfbc1e60270388cc877705477f082.png" src="../../_images/62524420f83fa4d0b36978e3dc0d18218cbcfbc1e60270388cc877705477f082.png" />
</div>
</div>
</div>
<div class="section" id="id4">
<h3>2.3 Нахождение компонент связности в графе<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h3>
<p>Компоненты связности — это подмножества узлов, которые соединены друг с другом рёбрами, и нет рёбер между компонентами. Этот анализ полезен для изучения сегментации сети.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Находим компоненты связности в графе</span>
<span class="n">components</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">to_undirected</span><span class="p">()))</span>

<span class="c1"># Выводим количество компонент и размер первой компоненты</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Количество компонент связности: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Размер первой компоненты: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Количество компонент связности: 1
Размер первой компоненты: 531
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Мы находим компоненты связности в графе, преобразуя его в неориентированный граф.</p></li>
<li><p>Выводим количество компонент и размер первой компоненты.</p></li>
<li><p>Этот анализ помогает понять, насколько сеть разделена на отдельные части.</p></li>
</ul>
</div>
<div class="section" id="id5">
<h3>2.4 Вычисление матрицы расстояний между узлами<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h3>
<p>Матрица расстояний между всеми узлами графа полезна для анализа, чтобы понять, как далеко друг от друга находятся узлы в сети.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Вычисляем матрицу расстояний между всеми узлами</span>
<span class="n">distance_matrix</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">all_pairs_dijkstra_path_length</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;length&#39;</span><span class="p">))</span>

<span class="c1"># Пример: Расстояние от первого узла до всех других</span>
<span class="n">first_node</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">distances_from_first_node</span> <span class="o">=</span> <span class="n">distance_matrix</span><span class="p">[</span><span class="n">first_node</span><span class="p">]</span>

<span class="c1"># Выводим первые 5 расстояний</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">distances_from_first_node</span><span class="o">.</span><span class="n">items</span><span class="p">())[:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(175048165, 0), (1387234850, 24.667), (2908690121, 55.996), (1387234852, 78.44800000000001), (1387234851, 101.275)]
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Мы вычисляем матрицу расстояний между всеми узлами с использованием алгоритма Дейкстры.</p></li>
<li><p>Выводим расстояния от первого узла до других узлов в графе.</p></li>
<li><p>Эта информация полезна для анализа доступности и плотности сети.</p></li>
</ul>
</div>
<div class="section" id="id6">
<h3>2.5 Изохроны (пешеходная доступность)<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h3>
<p>Изохроны представляют собой области, которые можно достичь за определенный промежуток времени. Например, можно построить изохрону, которая охватывает территорию, которую можно достичь за 15 минут пешком.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Указываем координаты начальной точки (например, центр Ленинского района)</span>
<span class="n">start_coords</span> <span class="o">=</span> <span class="p">(</span><span class="mf">60.6572</span><span class="p">,</span> <span class="mf">56.8385</span><span class="p">)</span>

<span class="c1"># Преобразуем координаты в узел графа</span>
<span class="n">start_node</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">nearest_nodes</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">start_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y</span><span class="o">=</span><span class="n">start_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Определяем максимальный радиус для изохроны (например, 15 минут пешеходного пути)</span>
<span class="n">max_time</span> <span class="o">=</span> <span class="mi">15</span> <span class="o">*</span> <span class="mi">60</span>  <span class="c1"># Время в секундах (15 минут)</span>

<span class="c1"># Строим подграф (зону доступности) вокруг ближайшего узла</span>
<span class="n">subgraph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">ego_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">start_node</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">max_time</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="s1">&#39;length&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/frame.py:717: DeprecationWarning: Passing a BlockManager to GeoDataFrame is deprecated and will raise in a future version. Use public APIs instead.
  warnings.warn(
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/algorithms.py:1743: DeprecationWarning: is_sparse is deprecated and will be removed in a future version. Check `isinstance(dtype, pd.SparseDtype)` instead.
  return lib.map_infer(values, mapper, convert=convert)
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/sklearn/utils/validation.py:605: DeprecationWarning: is_sparse is deprecated and will be removed in a future version. Check `isinstance(dtype, pd.SparseDtype)` instead.
  if is_sparse(pd_dtype):
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/sklearn/utils/validation.py:614: DeprecationWarning: is_sparse is deprecated and will be removed in a future version. Check `isinstance(dtype, pd.SparseDtype)` instead.
  if is_sparse(pd_dtype) or not is_extension_array_dtype(pd_dtype):
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ox</span><span class="o">.</span><span class="n">plot_graph</span><span class="p">(</span><span class="n">subgraph</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/frame.py:717: DeprecationWarning: Passing a BlockManager to GeoDataFrame is deprecated and will raise in a future version. Use public APIs instead.
  warnings.warn(
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/frame.py:717: DeprecationWarning: Passing a BlockManager to GeoDataFrame is deprecated and will raise in a future version. Use public APIs instead.
  warnings.warn(
</pre></div>
</div>
<img alt="../../_images/4acb7d882474ade92a54cd67eb4d25784ec2fe7f68e909682dcb7a1b1f5adf07.png" src="../../_images/4acb7d882474ade92a54cd67eb4d25784ec2fe7f68e909682dcb7a1b1f5adf07.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 800x800 with 1 Axes&gt;, &lt;Axes: &gt;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Получаем геометрию зоны доступности (линии)</span>
<span class="n">area</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">convert</span><span class="o">.</span><span class="n">graph_to_gdfs</span><span class="p">(</span><span class="n">subgraph</span><span class="p">,</span> <span class="n">nodes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Объединяем все линии в одну геометрию</span>
<span class="n">service_area_lines</span> <span class="o">=</span> <span class="n">area</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">unary_union</span>

<span class="c1"># Создаем ограничивающую геометрию вокруг участка УДС</span>
<span class="n">isochrone</span> <span class="o">=</span> <span class="n">service_area_lines</span><span class="o">.</span><span class="n">convex_hull</span>

<span class="c1"># Визуализируем</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">area</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">([</span><span class="n">isochrone</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Isochrone for 15 minutes walk&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/frame.py:717: DeprecationWarning: Passing a BlockManager to GeoDataFrame is deprecated and will raise in a future version. Use public APIs instead.
  warnings.warn(
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/frame.py:717: DeprecationWarning: Passing a BlockManager to GeoDataFrame is deprecated and will raise in a future version. Use public APIs instead.
  warnings.warn(
</pre></div>
</div>
<img alt="../../_images/556e271d2e660812bad8f2ddb2547323c82a71a01a74dff96977112c8d51c460.png" src="../../_images/556e271d2e660812bad8f2ddb2547323c82a71a01a74dff96977112c8d51c460.png" />
</div>
</div>
</div>
</div>
<div class="section" id="api">
<h2>3. Пространственный сетевой анализ с использованием внешних API<a class="headerlink" href="#api" title="Permalink to this heading">#</a></h2>
<p>Множество сервисов и библиотек предоставляют готовые решения для работы с пространственными сетями</p>
<div class="section" id="osrm">
<h3>3.1. <a class="reference external" href="https://project-osrm.org">OSRM</a><a class="headerlink" href="#osrm" title="Permalink to this heading">#</a></h3>
<div class="section" id="id7">
<h4>3.1.1 Кратчайшее расстояние<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="c1"># URL API OSRM</span>
<span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;http://router.project-osrm.org/route/v1/driving/&quot;</span>

<span class="c1"># Координаты точек (долгота, широта)</span>
<span class="n">start_coords</span> <span class="o">=</span> <span class="p">[</span><span class="mf">55.7558</span><span class="p">,</span> <span class="mf">37.6173</span><span class="p">]</span>
<span class="n">end_coords</span> <span class="o">=</span> <span class="p">[</span><span class="mf">55.7045</span><span class="p">,</span> <span class="mf">37.5308</span><span class="p">]</span>

<span class="n">start</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">start_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> 
<span class="n">end</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">end_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">end_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># Запрос к API</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}{</span><span class="n">start</span><span class="si">}</span><span class="s2">;</span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">?overview=full&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<span class="c1"># Извлечение расстояния и маршрута</span>
<span class="n">distance</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;routes&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span>  <span class="c1"># В метрах</span>
<span class="n">route</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;routes&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span>  <span class="c1"># GeoJSON</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shortest distance: </span><span class="si">{</span><span class="n">distance</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Shortest distance: 12.45 km
</pre></div>
</div>
</div>
</div>
<p>Посмотрим на результат на карте</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">polyline</span> 
<span class="kn">import</span> <span class="nn">folium</span>

<span class="c1"># Декодируем маршрут из GeoJSON</span>
<span class="n">decoded_route</span> <span class="o">=</span> <span class="n">polyline</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>

<span class="c1"># Визуализация с помощью folium</span>
<span class="c1"># Создаем карту с центром в стартовой точке</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">start_coords</span><span class="p">,</span> <span class="n">zoom_start</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">tiles</span><span class="o">=</span><span class="s1">&#39;cartodbpositron&#39;</span><span class="p">)</span>

<span class="c1"># Добавляем маршрут на карту</span>
<span class="n">folium</span><span class="o">.</span><span class="n">PolyLine</span><span class="p">(</span><span class="n">decoded_route</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># Добавляем маркеры для стартовой и конечной точки</span>
<span class="n">folium</span><span class="o">.</span><span class="n">Marker</span><span class="p">(</span><span class="n">start_coords</span><span class="p">,</span> <span class="n">popup</span><span class="o">=</span><span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="n">folium</span><span class="o">.</span><span class="n">Icon</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">folium</span><span class="o">.</span><span class="n">Marker</span><span class="p">(</span><span class="n">end_coords</span><span class="p">,</span> <span class="n">popup</span><span class="o">=</span><span class="s2">&quot;End&quot;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="n">folium</span><span class="o">.</span><span class="n">Icon</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># Отображаем карту</span>
<span class="n">m</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style="width:100%;"><div style="position:relative;width:100%;height:0;padding-bottom:60%;"><span style="color:#565656">Make this Notebook Trusted to load map: File -> Trust Notebook</span><iframe srcdoc="&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    
    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;
    
        &lt;script&gt;
            L_NO_TOUCH = false;
            L_DISABLE_3D = false;
        &lt;/script&gt;
    
    &lt;style&gt;html, body {width: 100%;height: 100%;margin: 0;padding: 0;}&lt;/style&gt;
    &lt;style&gt;#map {position:absolute;top:0;bottom:0;right:0;left:0;}&lt;/style&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://code.jquery.com/jquery-1.12.4.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;&gt;&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/&gt;
    
            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;
            &lt;style&gt;
                #map_0e058e473571e456f5e13e35b73e7c75 {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            &lt;/style&gt;
        
&lt;/head&gt;
&lt;body&gt;
    
    
            &lt;div class=&quot;folium-map&quot; id=&quot;map_0e058e473571e456f5e13e35b73e7c75&quot; &gt;&lt;/div&gt;
        
&lt;/body&gt;
&lt;script&gt;
    
    
            var map_0e058e473571e456f5e13e35b73e7c75 = L.map(
                &quot;map_0e058e473571e456f5e13e35b73e7c75&quot;,
                {
                    center: [55.7558, 37.6173],
                    crs: L.CRS.EPSG3857,
                    zoom: 12,
                    zoomControl: true,
                    preferCanvas: false,
                }
            );

            

        
    
            var tile_layer_7fb063b33c6cccb2df058708e8ade083 = L.tileLayer(
                &quot;https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png&quot;,
                {&quot;attribution&quot;: &quot;\u0026copy; \u003ca target=\&quot;_blank\&quot; href=\&quot;http://www.openstreetmap.org/copyright\&quot;\u003eOpenStreetMap\u003c/a\u003e contributors \u0026copy; \u003ca target=\&quot;_blank\&quot; href=\&quot;http://cartodb.com/attributions\&quot;\u003eCartoDB\u003c/a\u003e, CartoDB \u003ca target=\&quot;_blank\&quot; href =\&quot;http://cartodb.com/attributions\&quot;\u003eattributions\u003c/a\u003e&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 18, &quot;maxZoom&quot;: 18, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            ).addTo(map_0e058e473571e456f5e13e35b73e7c75);
        
    
            var poly_line_e04127d8674481e69f2b8e79eb3e3571 = L.polyline(
                [[55.75637, 37.61695], [55.75637, 37.61692], [55.75636, 37.61688], [55.75636, 37.61683], [55.75637, 37.61679], [55.75637, 37.61675], [55.75638, 37.61672], [55.7565, 37.61649], [55.7566, 37.61631], [55.75676, 37.61602], [55.75694, 37.61568], [55.75695, 37.61565], [55.75696, 37.61562], [55.75698, 37.6156], [55.75704, 37.61554], [55.75709, 37.61563], [55.75715, 37.61575], [55.75722, 37.61586], [55.7573, 37.61599], [55.75742, 37.61618], [55.75766, 37.61657], [55.75788, 37.6169], [55.75803, 37.61714], [55.75818, 37.61738], [55.75837, 37.61771], [55.75845, 37.6179], [55.75848, 37.61801], [55.75851, 37.61816], [55.75856, 37.61844], [55.75861, 37.6187], [55.75864, 37.61889], [55.75873, 37.61935], [55.7588, 37.61976], [55.75881, 37.61981], [55.75882, 37.61988], [55.75885, 37.62007], [55.75886, 37.62014], [55.7589, 37.62034], [55.75898, 37.62085], [55.75899, 37.62091], [55.7591, 37.62159], [55.75919, 37.62219], [55.75922, 37.62243], [55.75927, 37.62277], [55.75939, 37.62373], [55.75954, 37.62479], [55.75954, 37.62524], [55.75953, 37.62547], [55.75951, 37.62565], [55.75947, 37.62582], [55.75945, 37.62589], [55.75943, 37.62594], [55.75935, 37.6261], [55.75922, 37.62634], [55.75889, 37.62679], [55.75865, 37.62713], [55.75851, 37.62733], [55.7583, 37.62761], [55.75812, 37.62786], [55.75787, 37.6282], [55.7577, 37.62844], [55.75738, 37.62888], [55.75691, 37.62953], [55.75672, 37.62979], [55.75666, 37.62988], [55.75663, 37.62996], [55.75658, 37.63008], [55.75656, 37.63013], [55.75656, 37.63018], [55.75655, 37.63031], [55.75653, 37.6304], [55.75652, 37.63043], [55.75632, 37.63074], [55.75567, 37.6317], [55.75477, 37.63292], [55.75465, 37.63305], [55.75455, 37.63315], [55.75441, 37.63327], [55.75428, 37.63336], [55.75412, 37.63343], [55.75399, 37.63346], [55.75389, 37.63347], [55.75369, 37.63348], [55.75343, 37.63347], [55.7533, 37.63346], [55.75311, 37.63342], [55.75254, 37.63326], [55.75236, 37.63319], [55.75233, 37.63318], [55.75218, 37.63313], [55.75213, 37.63311], [55.75159, 37.63295], [55.75094, 37.63274], [55.7508, 37.63269], [55.75057, 37.63261], [55.75045, 37.63257], [55.75033, 37.63247], [55.75022, 37.63242], [55.74997, 37.63231], [55.7498, 37.63225], [55.7497, 37.63221], [55.74969, 37.6322], [55.74967, 37.63218], [55.74965, 37.63215], [55.74964, 37.63211], [55.74963, 37.63206], [55.74963, 37.63199], [55.74963, 37.63195], [55.74968, 37.63136], [55.74972, 37.63075], [55.74977, 37.63], [55.74979, 37.62975], [55.74979, 37.62965], [55.74982, 37.62923], [55.74983, 37.62913], [55.74986, 37.62868], [55.74988, 37.62831], [55.7499, 37.62786], [55.74991, 37.6275], [55.74991, 37.62719], [55.74991, 37.62688], [55.7499, 37.62654], [55.7499, 37.62636], [55.74988, 37.62586], [55.74987, 37.62571], [55.74985, 37.62549], [55.74984, 37.62531], [55.74983, 37.62524], [55.74979, 37.62477], [55.74975, 37.62437], [55.74972, 37.62412], [55.74968, 37.62381], [55.74962, 37.62325], [55.7496, 37.62311], [55.74959, 37.62297], [55.74953, 37.62232], [55.74947, 37.62174], [55.74941, 37.62116], [55.74934, 37.62065], [55.74931, 37.62047], [55.74924, 37.62], [55.74921, 37.61981], [55.7491, 37.61907], [55.74904, 37.6187], [55.74899, 37.61836], [55.74885, 37.61739], [55.74882, 37.61721], [55.7488, 37.61706], [55.74877, 37.61686], [55.74873, 37.61668], [55.74868, 37.61644], [55.74862, 37.61622], [55.74859, 37.61611], [55.74829, 37.61496], [55.74814, 37.61438], [55.74807, 37.61411], [55.74796, 37.61367], [55.74795, 37.61362], [55.74791, 37.61343], [55.74785, 37.6132], [55.74779, 37.61279], [55.74774, 37.61254], [55.74769, 37.61234], [55.74757, 37.61199], [55.7475, 37.61176], [55.74742, 37.61151], [55.74735, 37.61131], [55.74727, 37.61109], [55.74719, 37.61094], [55.74715, 37.61085], [55.74706, 37.61069], [55.74694, 37.61048], [55.7468, 37.61026], [55.74656, 37.60994], [55.74648, 37.60984], [55.74652, 37.60975], [55.74656, 37.60965], [55.74672, 37.60928], [55.74683, 37.60903], [55.74689, 37.60889], [55.74715, 37.60826], [55.74726, 37.608], [55.74734, 37.6078], [55.74741, 37.60761], [55.74705, 37.60716], [55.74703, 37.60714], [55.74691, 37.60695], [55.74689, 37.60694], [55.74673, 37.60665], [55.74656, 37.60635], [55.74655, 37.60632], [55.74645, 37.60601], [55.74621, 37.60553], [55.74605, 37.60522], [55.74591, 37.60495], [55.74585, 37.60485], [55.74551, 37.60418], [55.74522, 37.60363], [55.74492, 37.60306], [55.74483, 37.6029], [55.74477, 37.60278], [55.74471, 37.60267], [55.74462, 37.60252], [55.74452, 37.60236], [55.74449, 37.60231], [55.74445, 37.60227], [55.74436, 37.60219], [55.74426, 37.60206], [55.74423, 37.60203], [55.74405, 37.60184], [55.74386, 37.60162], [55.74377, 37.60153], [55.74367, 37.60143], [55.74337, 37.60111], [55.74331, 37.60104], [55.74317, 37.6009], [55.74292, 37.60065], [55.74282, 37.60054], [55.74273, 37.60045], [55.74266, 37.60037], [55.74229, 37.59998], [55.74224, 37.59993], [55.74217, 37.59985], [55.74206, 37.59974], [55.74177, 37.59942], [55.74172, 37.59935], [55.74165, 37.59926], [55.7416, 37.59916], [55.74139, 37.59884], [55.74124, 37.5986], [55.74109, 37.59836], [55.74103, 37.59826], [55.74099, 37.5982], [55.74089, 37.59803], [55.74056, 37.5975], [55.7405, 37.5974], [55.74043, 37.59729], [55.74023, 37.59698], [55.74004, 37.59667], [55.73999, 37.5966], [55.73994, 37.59654], [55.73988, 37.59649], [55.7398, 37.59642], [55.73956, 37.59628], [55.73944, 37.5962], [55.73937, 37.59615], [55.73909, 37.59598], [55.73894, 37.59588], [55.73884, 37.59582], [55.7387, 37.59573], [55.7386, 37.59567], [55.7384, 37.59556], [55.73811, 37.59539], [55.73803, 37.59531], [55.73795, 37.59526], [55.73742, 37.59505], [55.73737, 37.59502], [55.7373, 37.595], [55.73722, 37.59502], [55.73716, 37.59502], [55.73711, 37.59501], [55.73649, 37.59477], [55.73622, 37.59464], [55.73593, 37.59451], [55.73561, 37.59435], [55.7352, 37.59411], [55.73447, 37.59367], [55.73376, 37.59321], [55.73345, 37.59301], [55.73318, 37.5928], [55.73235, 37.59228], [55.73214, 37.59213], [55.73198, 37.59199], [55.73191, 37.59192], [55.73189, 37.5919], [55.73177, 37.59177], [55.73161, 37.59155], [55.73153, 37.59142], [55.73141, 37.59119], [55.73131, 37.59098], [55.7312, 37.59072], [55.7306, 37.58912], [55.7305, 37.58885], [55.72943, 37.58595], [55.729, 37.58477], [55.72888, 37.58448], [55.72877, 37.58423], [55.72862, 37.58396], [55.72855, 37.58387], [55.72844, 37.58371], [55.72688, 37.58157], [55.72664, 37.58125], [55.72657, 37.58116], [55.72655, 37.58113], [55.72584, 37.58012], [55.72474, 37.57868], [55.72464, 37.57854], [55.72436, 37.57818], [55.72413, 37.57786], [55.72267, 37.57589], [55.72249, 37.57564], [55.72239, 37.5755], [55.72219, 37.57522], [55.7221, 37.5751], [55.72189, 37.57482], [55.72079, 37.57333], [55.71985, 37.57205], [55.71966, 37.57179], [55.71935, 37.57137], [55.71894, 37.57082], [55.71864, 37.5704], [55.71849, 37.5702], [55.71841, 37.57006], [55.71809, 37.56963], [55.71761, 37.56899], [55.71759, 37.56897], [55.71741, 37.56874], [55.71683, 37.56796], [55.71636, 37.56733], [55.71591, 37.56668], [55.71584, 37.56659], [55.7121, 37.56151], [55.71145, 37.56063], [55.70775, 37.55566], [55.70657, 37.55402], [55.70597, 37.55321], [55.70326, 37.54956], [55.70286, 37.54903], [55.70244, 37.54845], [55.70239, 37.54832], [55.70234, 37.54818], [55.70229, 37.54798], [55.70218, 37.54761], [55.70121, 37.54633], [55.70116, 37.54626], [55.70122, 37.54616], [55.70141, 37.54582], [55.70148, 37.5457], [55.70423, 37.54087], [55.70444, 37.5405], [55.70455, 37.54031], [55.70465, 37.54013], [55.70479, 37.53988], [55.70517, 37.53922], [55.706, 37.53776], [55.70607, 37.53763], [55.70642, 37.53702], [55.7068, 37.53635], [55.70685, 37.53626], [55.70773, 37.53477], [55.70809, 37.53416], [55.70823, 37.5339], [55.70832, 37.53374], [55.70783, 37.53288], [55.70777, 37.53277], [55.70775, 37.53275], [55.70756, 37.53239], [55.70719, 37.53174], [55.70704, 37.53147], [55.70694, 37.53129], [55.70617, 37.52992], [55.70593, 37.5295], [55.70588, 37.5294], [55.70564, 37.52898], [55.70492, 37.52769], [55.70481, 37.52749], [55.70464, 37.52718], [55.70433, 37.52664], [55.70424, 37.52679], [55.70432, 37.52693], [55.7046, 37.52743], [55.70473, 37.52765], [55.70474, 37.52767], [55.70491, 37.52797], [55.70525, 37.52858], [55.70521, 37.52865], [55.70512, 37.52882], [55.70509, 37.52887], [55.70501, 37.52901], [55.70511, 37.5292], [55.70493, 37.52952], [55.70438, 37.53049], [55.70434, 37.53056], [55.70449, 37.53082]],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;blue&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: false, &quot;fillColor&quot;: &quot;blue&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;noClip&quot;: false, &quot;opacity&quot;: 0.7, &quot;smoothFactor&quot;: 1.0, &quot;stroke&quot;: true, &quot;weight&quot;: 5}
            ).addTo(map_0e058e473571e456f5e13e35b73e7c75);
        
    
            var marker_5812e23075e77af5a9ba6886f86a005c = L.marker(
                [55.7558, 37.6173],
                {}
            ).addTo(map_0e058e473571e456f5e13e35b73e7c75);
        
    
            var icon_189e10bb0b50f57ed6344aa42d5529db = L.AwesomeMarkers.icon(
                {&quot;extraClasses&quot;: &quot;fa-rotate-0&quot;, &quot;icon&quot;: &quot;info-sign&quot;, &quot;iconColor&quot;: &quot;white&quot;, &quot;markerColor&quot;: &quot;green&quot;, &quot;prefix&quot;: &quot;glyphicon&quot;}
            );
            marker_5812e23075e77af5a9ba6886f86a005c.setIcon(icon_189e10bb0b50f57ed6344aa42d5529db);
        
    
        var popup_e81c4b2bae760b4788b904e5f58d03e1 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_bc732f0032354e632f5f506ae718a605 = $(`&lt;div id=&quot;html_bc732f0032354e632f5f506ae718a605&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Start&lt;/div&gt;`)[0];
                popup_e81c4b2bae760b4788b904e5f58d03e1.setContent(html_bc732f0032354e632f5f506ae718a605);
            
        

        marker_5812e23075e77af5a9ba6886f86a005c.bindPopup(popup_e81c4b2bae760b4788b904e5f58d03e1)
        ;

        
    
    
            var marker_0abe75d4d9767d6a35dc7803e67645eb = L.marker(
                [55.7045, 37.5308],
                {}
            ).addTo(map_0e058e473571e456f5e13e35b73e7c75);
        
    
            var icon_94917e110b5e1d4ecd61687cf87a5e28 = L.AwesomeMarkers.icon(
                {&quot;extraClasses&quot;: &quot;fa-rotate-0&quot;, &quot;icon&quot;: &quot;info-sign&quot;, &quot;iconColor&quot;: &quot;white&quot;, &quot;markerColor&quot;: &quot;red&quot;, &quot;prefix&quot;: &quot;glyphicon&quot;}
            );
            marker_0abe75d4d9767d6a35dc7803e67645eb.setIcon(icon_94917e110b5e1d4ecd61687cf87a5e28);
        
    
        var popup_1d32b00e9d9ee1de2c2e6474d3d9b6f8 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_9068759aed0c5fe21dae094823d69b16 = $(`&lt;div id=&quot;html_9068759aed0c5fe21dae094823d69b16&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;End&lt;/div&gt;`)[0];
                popup_1d32b00e9d9ee1de2c2e6474d3d9b6f8.setContent(html_9068759aed0c5fe21dae094823d69b16);
            
        

        marker_0abe75d4d9767d6a35dc7803e67645eb.bindPopup(popup_1d32b00e9d9ee1de2c2e6474d3d9b6f8)
        ;

        
    
&lt;/script&gt;
&lt;/html&gt;" style="position:absolute;width:100%;height:100%;left:0;top:0;border:none !important;" allowfullscreen webkitallowfullscreen mozallowfullscreen></iframe></div></div></div></div>
</div>
</div>
</div>
<div class="section" id="open-route-service">
<h3>3.2. <a class="reference external" href="https://openrouteservice.org">Open Route Service</a><a class="headerlink" href="#open-route-service" title="Permalink to this heading">#</a></h3>
<p><strong>Примечание:</strong> в этом и последующих разделах результаты не будут отображаться здесь, так как для выполнения кода требуются личные API-ключи. Вы можете получить их в своём личном кабинете у каждого провайдера по соответствующим ссылкам и запустить код локально на компьютере. Места, куда нужно вставить ключ, обозначены как <code class="docutils literal notranslate"><span class="pre">your_key</span></code>.</p>
<div class="section" id="id8">
<h4>3.2.1. Изохроны<a class="headerlink" href="#id8" title="Permalink to this heading">#</a></h4>
<p>В запросе мы передаём:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>locations</strong> — список из одной точки (координаты, но в формате [долгота, широта]);</p></li>
<li><p><strong>range</strong> — список интервалов времени (в секундах), для которых хотим построить изохроны (300 с = 5 мин, 600 с = 10 мин и т. д.);</p></li>
<li><p><strong>units</strong> = “m” (метры) и запрашиваем некоторые атрибуты, например, площадь полигона.</p></li>
</ul>
</div></blockquote>
<p>Через <code class="docutils literal notranslate"><span class="pre">requests.post</span></code> отправляем запрос, получаем GeoJSON — и сразу же при помощи <code class="docutils literal notranslate"><span class="pre">gpd.read_file</span></code> превращаем его в GeoDataFrame, готовый для дальнейшей визуализации.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="c1"># API OpenRouteService (требуется ключ API)</span>
<span class="n">ors_api_key</span> <span class="o">=</span> <span class="s2">&quot;your_key&quot;</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://api.openrouteservice.org/v2/isochrones/foot-walking&quot;</span>

<span class="c1"># Параметры</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;locations&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mf">37.6173</span><span class="p">,</span> <span class="mf">55.7558</span><span class="p">]],</span> 
    <span class="s2">&quot;range&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">300</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">900</span><span class="p">],</span>  <span class="c1"># Изохроны в секундах (5, 10, 15 минут)</span>
<span class="p">}</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="n">ors_api_key</span><span class="p">,</span>
    <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Запрос к API</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="n">isochrones</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>


<span class="c1"># Преобразуем GeoJSON в GeoDataFrame</span>
<span class="n">gdf_isochrones</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span>
    <span class="n">isochrones</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span>
<span class="p">)</span>

<span class="c1">#Визуализируем результат на карте</span>
<span class="n">gdf_isochrones</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span> <span class="n">tiles</span><span class="o">=</span><span class="s1">&#39;cartodbpositron&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/urllib3/util/ssl_.py:260: DeprecationWarning: ssl.PROTOCOL_TLS is deprecated
  context = SSLContext(ssl_version or PROTOCOL_TLS)
/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/urllib3/connection.py:407: DeprecationWarning: ssl.match_hostname() is deprecated
  match_hostname(cert, asserted_hostname)
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="n">line</span> <span class="mi">25</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span> <span class="n">isochrones</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span> <span class="c1"># Преобразуем GeoJSON в GeoDataFrame</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span> <span class="n">gdf_isochrones</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span>
<span class="ne">---&gt; </span><span class="mi">25</span>     <span class="n">isochrones</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span> <span class="c1">#Визуализируем результат на карте</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span> <span class="n">gdf_isochrones</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span> <span class="n">tiles</span><span class="o">=</span><span class="s1">&#39;cartodbpositron&#39;</span><span class="p">)</span>

<span class="ne">KeyError</span>: &#39;features&#39;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id9">
<h4>3.2.2. Кратчайшее расстояние<a class="headerlink" href="#id9" title="Permalink to this heading">#</a></h4>
<blockquote>
<div><ol class="arabic simple">
<li><p>Для получения детального маршрута через OpenRouteService указываем два пункта (координаты) в параметре <code class="docutils literal notranslate"><span class="pre">coordinates</span></code>.</p></li>
<li><p>В ответе мы получаем GeoJSON, где в <code class="docutils literal notranslate"><span class="pre">features</span></code> лежит LineString с трассой маршрута.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gpd.GeoDataFrame.from_features</span></code> позволяет превратить GeoJSON-маршрут в GeoDataFrame, что упрощает отрисовку</p></li>
</ol>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ors_url</span> <span class="o">=</span> <span class="s2">&quot;https://api.openrouteservice.org/v2/directions/driving-car&quot;</span>


<span class="c1"># Параметры запроса</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;37.6173,55.7558&quot;</span><span class="p">,</span>
    <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="s2">&quot;37.5665,55.7332&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="n">ors_api_key</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ors_url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<span class="c1"># Достаем расстояние и время</span>
<span class="n">distance</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;properties&quot;</span><span class="p">][</span><span class="s2">&quot;segments&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span>  <span class="c1"># в метрах</span>
<span class="n">duration</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;properties&quot;</span><span class="p">][</span><span class="s2">&quot;segments&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>  <span class="c1"># в секундах</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distance: </span><span class="si">{</span><span class="n">distance</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duration: </span><span class="si">{</span><span class="n">duration</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">60</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> minutes&quot;</span><span class="p">)</span>


<span class="c1"># Преобразуем GeoJSON в GeoDataFrame</span>
<span class="n">gdf_path</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span>
    <span class="n">path</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span>
<span class="p">)</span>

<span class="c1">#Визуализируем результат на карте</span>
<span class="n">gdf_path</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">tiles</span><span class="o">=</span><span class="s1">&#39;cartodbpositron&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id10">
<h4>3.2.3 Матрица расстояний<a class="headerlink" href="#id10" title="Permalink to this heading">#</a></h4>
<blockquote>
<div><p>Матрица расстояний (distance matrix) возвращает таблицу, где каждая ячейка (i,j) — это расстояние (или время) от точки i до точки j.</p>
<ul class="simple">
<li><p><strong>locations</strong> — массив координат точек, между которыми нужно узнать расстояния/времена.</p></li>
<li><p><strong>metrics</strong> задаёт, что именно возвращать: расстояние (в метрах) и длительность (в секундах).<br />
Результат <code class="docutils literal notranslate"><span class="pre">matrix_data</span></code> — JSON, внутри которого есть <code class="docutils literal notranslate"><span class="pre">distances</span></code> (матрица чисел) и <code class="docutils literal notranslate"><span class="pre">durations</span></code>. Дальше можно загрузить эти данные в Pandas DataFrame и визуализировать в виде «тепловой» матрицы или просто использовать для расчётов.</p></li>
</ul>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ors_matrix_url</span> <span class="o">=</span> <span class="s2">&quot;https://api.openrouteservice.org/v2/matrix/driving-car&quot;</span>

<span class="c1"># Координаты</span>
<span class="n">locations</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mf">37.6173</span><span class="p">,</span> <span class="mf">55.7558</span><span class="p">],</span> 
    <span class="p">[</span><span class="mf">37.5665</span><span class="p">,</span> <span class="mf">55.7332</span><span class="p">],</span>  
    <span class="p">[</span><span class="mf">37.5905</span><span class="p">,</span> <span class="mf">55.7602</span><span class="p">],</span>
<span class="p">]</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;locations&quot;</span><span class="p">:</span> <span class="n">locations</span><span class="p">,</span>
    <span class="s2">&quot;metrics&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">],</span>
<span class="p">}</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="n">ors_api_key</span><span class="p">,</span>
    <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">ors_matrix_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="n">matrix</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<span class="c1"># Вывод матрицы расстояний</span>
<span class="nb">print</span><span class="p">(</span><span class="n">matrix</span><span class="p">[</span><span class="s2">&quot;distances&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">matrix</span><span class="p">[</span><span class="s2">&quot;durations&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="graphopper">
<h3>3.3 <a class="reference external" href="https://www.graphhopper.com">Graphopper</a><a class="headerlink" href="#graphopper" title="Permalink to this heading">#</a></h3>
<div class="section" id="id11">
<h4>3.3.1. Кратчайшее расстояние<a class="headerlink" href="#id11" title="Permalink to this heading">#</a></h4>
<blockquote>
<div><ol class="arabic simple">
<li><p>GraphHopper API позволяет запрашивать маршруты аналогично ORS, но у него немного иной формат запроса:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">point</span></code> — список координат в формате «широта,долгота»;</p></li>
<li><p>указываем <code class="docutils literal notranslate"><span class="pre">vehicle=&quot;car&quot;</span></code> и локализацию <code class="docutils literal notranslate"><span class="pre">locale=&quot;ru&quot;</span></code>.</p></li>
</ul>
</li>
<li><p>В ответе <code class="docutils literal notranslate"><span class="pre">route_gh</span></code> содержатся подробности маршрута: дистанция (в метрах), время (в миллисекундах), сам трек (encoded polyline).</p></li>
<li><p>Эту информацию можно декодировать или сразу визуализировать, если преобразовать полилинию в геометрию.</p></li>
</ol>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gh_url</span> <span class="o">=</span> <span class="s2">&quot;https://graphhopper.com/api/1/route&quot;</span>
<span class="n">graphhopper_api_key</span> <span class="o">=</span> <span class="s2">&quot;your_key&quot;</span>

<span class="c1"># Параметры запроса</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;55.7558,37.6173&quot;</span><span class="p">,</span> <span class="s2">&quot;55.7332,37.5665&quot;</span><span class="p">],</span>  <span class="c1"># Москва, две точки</span>
    <span class="s2">&quot;vehicle&quot;</span><span class="p">:</span> <span class="s2">&quot;car&quot;</span><span class="p">,</span>
    <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">graphhopper_api_key</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">gh_url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
<span class="n">route</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<span class="c1"># Достаем расстояние и время</span>
<span class="n">distance</span> <span class="o">=</span> <span class="n">route</span><span class="p">[</span><span class="s2">&quot;paths&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span>  <span class="c1"># в метрах</span>
<span class="n">duration</span> <span class="o">=</span> <span class="n">route</span><span class="p">[</span><span class="s2">&quot;paths&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># в секундах</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distance: </span><span class="si">{</span><span class="n">distance</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duration: </span><span class="si">{</span><span class="n">duration</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">60</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> minutes&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id12">
<h4>3.3.2 Матрица расстояний<a class="headerlink" href="#id12" title="Permalink to this heading">#</a></h4>
<blockquote>
<div><ol class="arabic simple">
<li><p>Запрашиваем у GraphHopper матрицу расстояний/времён между списком точек.</p></li>
<li><p>Тело запроса (<code class="docutils literal notranslate"><span class="pre">body</span></code>) содержит:</p>
<ul class="simple">
<li><p>массив <code class="docutils literal notranslate"><span class="pre">points</span></code> (координаты точек),</p></li>
<li><p>список <code class="docutils literal notranslate"><span class="pre">vehicles</span></code> (тип транспортного средства),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">out_arrays</span></code> — какие массивы вернуть (расстояния или время).</p></li>
</ul>
</li>
<li><p>Ответ <code class="docutils literal notranslate"><span class="pre">matrix_gh</span></code> будет похож на структуру ORS: вложенные списки, где элемент [i][j] — это дистанция или время между точкой i и j.</p></li>
</ol>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gh_matrix_url</span> <span class="o">=</span> <span class="s2">&quot;https://graphhopper.com/api/1/matrix&quot;</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>

<span class="c1"># Координаты</span>
<span class="n">locations</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mf">37.6173</span><span class="p">,</span> <span class="mf">55.7558</span><span class="p">],</span>  <span class="c1"># точка 1</span>
    <span class="p">[</span><span class="mf">37.5665</span><span class="p">,</span> <span class="mf">55.7332</span><span class="p">],</span>  <span class="c1"># точка 2</span>
    <span class="p">[</span><span class="mf">37.5905</span><span class="p">,</span> <span class="mf">55.7602</span><span class="p">],</span>  <span class="c1"># точка 3</span>
<span class="p">]</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;points&quot;</span><span class="p">:</span> <span class="n">locations</span><span class="p">,</span>
    <span class="s2">&quot;vehicle&quot;</span><span class="p">:</span> <span class="s2">&quot;car&quot;</span><span class="p">,</span>
    <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">graphhopper_api_key</span><span class="p">,</span>
<span class="p">}</span>


<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">gh_matrix_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="n">matrix</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./modules/module_4"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">IV. Basics of Network Analysis</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#iv">IV. Введение в сетевой анализ</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#osmnx">1.Графы улично-дорожной сети из osmnx</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">1.1 Получение графа уличной сети</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#geodataframe">1.2 Преобразование графа в GeoDataFrame</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#networkx">2. Пространственный сетевой анализ и networkx</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">2.1 Поиск кратчайшего пути между двумя точками</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">2.2 Вычисление центральности в узле графов</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">2.3 Нахождение компонент связности в графе</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">2.4 Вычисление матрицы расстояний между узлами</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">2.5 Изохроны (пешеходная доступность)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#api">3. Пространственный сетевой анализ с использованием внешних API</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#osrm">3.1. OSRM</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">3.1.1 Кратчайшее расстояние</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#open-route-service">3.2. Open Route Service</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">3.2.1. Изохроны</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">3.2.2. Кратчайшее расстояние</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">3.2.3 Матрица расстояний</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#graphopper">3.3 Graphopper</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">3.3.1. Кратчайшее расстояние</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">3.3.2 Матрица расстояний</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Bella Mironova
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>